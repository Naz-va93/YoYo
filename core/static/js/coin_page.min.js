document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("progressBar"),e=parseFloat(t.getAttribute("data-current-price")),i=document.getElementById("coin__converter-from"),r=document.getElementById("coin__converter-to"),a=parseFloat(r.value.replace(",",".").replace(" ","")),o=document.getElementById("todayLowPrice"),n=document.getElementById("todayHighPrice");function l(t){if("string"==typeof t&&(t=parseFloat(t)),0===t)return"0";let e=Math.abs(t),i=2;0!==e&&e<1&&(i=-Math.floor(Math.log10(e))+2);let r=t.toLocaleString("en-US",{minimumFractionDigits:i,maximumFractionDigits:i});return r.replace(/(\.\d*[1-9])0+$|\.0*$/,"$1")}r.value=l(a),i.addEventListener("input",function(){(function t(){let e=parseFloat(i.getAttribute("data-coin-price-usd").replace(",",".").replace(" ","")),a=i.value.replace(",","."),o=a?parseFloat(a):0;r.value=l(o*e)})()});let s=document.querySelector(".coin__trading--coin__info"),c=document.querySelector(".coin__chart"),d=document.querySelectorAll(".coin__tab.market_price"),p=document.getElementById("coin__tab-container-history_price");d.forEach(t=>{t.addEventListener("click",function(e){!function t(e,i,r){1===i&&(c.classList.add("visually-hidden"),p.classList.add("visually-hidden"),s.classList.remove("visually-hidden")),0===i&&(s.classList.add("visually-hidden"),c.classList.remove("visually-hidden"),p.classList.remove("visually-hidden")),e.forEach(t=>{t.classList.remove("active")}),r.target.classList.add("active");let a=r.target.offsetWidth;document.querySelector(".coin__slider").style.transform=`translateX(${i*a}px)`}(d,parseInt(t.getAttribute("data-index")),e)})});let u=document.querySelectorAll(".coin__tab.history_price"),m=null;u.forEach(i=>{i.addEventListener("click",function(r){(function i(r,a,s,c,d){a.forEach(t=>{t.classList.remove("active")}),r.target.classList.add("active");let p=document.querySelector(".coin__chart-wrapper.period"),u=p.querySelector("canvas");u&&(m&&m.destroy(),p.removeChild(u)),(u=document.createElement("canvas")).id="coinChartHistoryPrice",p.appendChild(u);let h=u.getContext("2d"),$=h.createLinearGradient(0,0,0,400);$.addColorStop(0,"rgba(30, 116, 254, 0.4)"),$.addColorStop(.78966,"rgba(30, 116, 254, 0)"),fetch(`http://127.0.0.1:8000/coin-price-history?coinId=${c}&type=${d}&period=${s}`).then(t=>t.json()).then(i=>{if(h.clearRect(0,0,u.width,u.height),"success"===i.status){let r=i.data.history;r.sort((t,e)=>t.timestamp-e.timestamp);let a=r.map(t=>t.price),c=r.map(t=>{let e=new Date(1e3*t.timestamp);return"24h"===s?e.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}):e.toLocaleDateString("en-GB")});if(m=new Chart(h,{type:"line",data:{labels:c,datasets:[{data:a,borderColor:"#3c86fe",borderWidth:2,fill:!0,pointRadius:0,pointHoverRadius:0,lineTension:.1,backgroundColor:$}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0,mode:"index",intersect:!1,displayColors:!1,callbacks:{label:function(t){return l(t.raw)}}},crosshair:{line:{color:"#282b31",width:1},zoom:{enabled:!1}}},scales:{y:{ticks:{color:"rgb(148, 149, 152)",font:{family:"Commissioner",size:12},callback:function(t){return void 0!==t?l(t):""}},beginAtZero:!1,position:"right",border:{display:!1},grid:{color:"#949598",lineWidth:.6}},x:{ticks:{align:"start",autoSkip:!0,maxTicksLimit:6,color:"rgb(148, 149, 152)",font:{family:"Commissioner",size:12}},grid:{display:!1}}}}}),"24h"===s){if(minPrice=Math.min(...a),maxPrice=Math.max(...a),o.textContent=`$${minPrice?l(minPrice):"--"}`,n.textContent=`$${maxPrice?l(maxPrice):"--"}`,maxPrice-minPrice!=0){let d=(e-minPrice)/(maxPrice-minPrice)*100;t.style.width=`${d}%`}else t.style.width="0%"}}else h.fillText("Error loading data",u.width/2-50,u.height/2)}).catch(t=>{console.error("Error fetching data:",t),h.fillText("Error loading data",u.width/2-50,u.height/2)})})(r,u,i.getAttribute("data-period"),i.getAttribute("data-coin-api-id"),i.getAttribute("data-coin-api-type"))})}),document.querySelector('.coin__tab.history_price[data-period="24h"]').click();let h=document.querySelector(".coin__tab.history_price.all_time"),$=h.getAttribute("data-coin-api-id"),g=h.getAttribute("data-coin-api-type"),y=document.getElementById("coinChartAllHistoryPrice"),_=y.getContext("2d");y.height=80,fetch(`http://127.0.0.1:8000/coin-price-history?coinId=${$}&type=${g}&period=all`).then(t=>t.json()).then(t=>{if("success"===t.status){let e=t.data.history;e.sort((t,e)=>t.timestamp-e.timestamp);let i=e.map(t=>t.price),r=e.map(t=>new Date(1e3*t.timestamp).getFullYear());allTimeChart=new Chart(_,{type:"line",data:{labels:r,datasets:[{data:i,borderColor:"#3c86fe",borderWidth:2,fill:!1,pointRadius:0,pointHoverRadius:0,lineTension:.1}]},options:{tooltip:{enabled:!1},responsive:!0,maintainAspectRatio:!1,scales:{y:{display:!0,position:"right",grid:{display:!1},ticks:{color:"transparent",font:{family:"Commissioner",size:12}},border:{display:!1}},x:{ticks:{align:"start",autoSkip:!0,maxTicksLimit:6,color:"rgb(148, 149, 152)",font:{family:"Commissioner",size:12}},grid:{color:"#5b5c61",lineWidth:.4},border:{color:"#5b5c61",width:.4}}},plugins:{legend:{display:!1},tooltip:{enabled:!1},crosshair:!1}}})}})});